---
title: "CapstoneProject"
author: "Vivek Appadurai"
date: "February 20, 2016"
output:
    html_document:
        keep_md: true
---

## Loading Libraries

```{r, message = FALSE}
library(dplyr)
library(ggplot2)
library(knitr)
library(gridExtra)
library(pROC)
library(leaps)
library(MASS)
library(e1071)
library(mlbench)
library(caret)
library(randomForest)
library(rpart)
library(ROCR)
```

## Reading Data

```{r}
variableInfo <- read.table("Names.txt", 
                           header = T, 
                           sep = "\t", 
                           fill = NA, 
                           quote = "",
                           stringsAsFactors = FALSE)

ticDataTraining <- read.table("ticdata2000.txt", 
                              header = F, 
                              sep = "\t", 
                              fill = NA, 
                              quote = "", 
                              stringsAsFactors = FALSE)

ticDataTest <- read.table("ticeval2000.txt", 
                          header = F, 
                          sep = "\t", 
                          fill = NA, 
                          quote = "",
                          stringsAsFactors = FALSE)

targets <- read.table("tictgts2000.txt",
                              header = F,
                              stringsAsFactors = FALSE)
```

## Data Cleaning

```{r}
colNames <- as.vector(variableInfo$Name)
names(ticDataTraining) <- colNames
ticDataTest <- cbind(ticDataTest, targets)
names(ticDataTest) <- colNames

ticDataTraining <- ticDataTraining %>% mutate(totalCaravanPolicies = sum(CARAVAN))
```

## Exploratory Data Analysis

Since the number of caravan policy holders within the training data is very low (348/5822 or apprxomiately 6%), 
its best to explore the assocaitions within the data by looking at the fraction of policy holders at each value 
for the varaibles along with the proportion of population at that particular value

```{r, include = FALSE}
ticDataTraining <- ticDataTraining %>% 
    group_by(MAANTHUI) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHomesOwned <- ggplot(data = ticDataTraining, aes(x = MAANTHUI)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MAANTHUI), 1)) +
    xlab("Number of Homes Owned") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>% 
    group_by(MGEMOMV) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHouseHoldSize <- ggplot(data = ticDataTraining, aes(x = MGEMOMV)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MGEMOMV), 1)) +
    xlab("Average Household Size") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>% 
    group_by(MGEMLEEF) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

PlotAvgAge <- ggplot(data = ticDataTraining, aes(x = MGEMLEEF)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MGEMLEEF), 1)) +
    xlab("Average Age") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>% 
    group_by(MGODRK) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotRomanCatholics <- ggplot(data = ticDataTraining, aes(x = MGODRK)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MGODRK), 1)) +
    xlab("Roman Catholics") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>% 
    group_by(MGODPR) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotProtestants <- ggplot(data = ticDataTraining, aes(x = MGODPR)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MGODPR), 1)) +
    xlab("Protestants") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>% 
    group_by(MGODOV) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotOtherReligion <- ggplot(data = ticDataTraining, aes(x = MGODOV)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MGODOV), 1)) +
    xlab("Other Religion") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MGODGE) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNoReligion <- ggplot(data = ticDataTraining, aes(x = MGODGE)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MGODGE), 1)) +
    xlab("No Religion") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MRELGE) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotMarried <- ggplot(data = ticDataTraining, aes(x = MRELGE)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MRELGE), 1)) +
    xlab("Married") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MRELSA) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotLivingTogether <- ggplot(data = ticDataTraining, aes(x = MRELSA)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MRELSA), 1)) +
    xlab("Living Together") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MRELOV) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotOtherRelation <- ggplot(data = ticDataTraining, aes(x = MRELOV)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MRELOV), 1)) +
    xlab("Other Relation") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MFALLEEN) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSingles <- ggplot(data = ticDataTraining, aes(x = MFALLEEN)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MFALLEEN), 1)) +
    xlab("Singles") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MFGEKIND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHouseholdNoChild <- ggplot(data = ticDataTraining, aes(x = MFGEKIND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MFGEKIND), 1)) +
    xlab("Household No Children") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MFWEKIND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHouseholdWithChild <- ggplot(data = ticDataTraining, aes(x = MFWEKIND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MFWEKIND), 1)) +
    xlab("Household With Children") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MOPLHOOG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHouseholdHighEd <- ggplot(data = ticDataTraining, aes(x = MOPLHOOG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MOPLHOOG), 1)) +
    xlab("High Level Education") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MOPLMIDD) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHouseholdMidEd <- ggplot(data = ticDataTraining, aes(x = MOPLMIDD)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MOPLMIDD), 1)) +
    xlab("Mid Level Education") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MOPLLAAG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHouseholdLowEd <- ggplot(data = ticDataTraining, aes(x = MOPLLAAG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MOPLLAAG), 1)) +
    xlab("Low Level Education") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MBERHOOG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotHighStatus <- ggplot(data = ticDataTraining, aes(x = MBERHOOG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MBERHOOG), 1)) +
    xlab("High Status") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MBERZELF) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotEntrepreneur <- ggplot(data = ticDataTraining, aes(x = MBERZELF)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MBERZELF), 1)) +
    xlab("Entrepreneur") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MBERBOER) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotFarmer <- ggplot(data = ticDataTraining, aes(x = MBERBOER)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MBERBOER), 1)) +
    xlab("Farmer") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MBERMIDD) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotMidManagement <- ggplot(data = ticDataTraining, aes(x = MBERMIDD)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MBERMIDD), 1)) +
    xlab("Middle Management") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MBERARBG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSkilledLabor <- ggplot(data = ticDataTraining, aes(x = MBERARBG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MBERARBG), 1)) +
    xlab("Skilled Laborers") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MBERARBO) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotUnskilledLabor <- ggplot(data = ticDataTraining, aes(x = MBERARBO)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MBERARBO), 1)) +
    xlab("Unskilled Laborers") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MSKA) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialA <- ggplot(data = ticDataTraining, aes(x = MSKA)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MSKA), 1)) +
    xlab("Social Class A") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MSKB1) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialB1 <- ggplot(data = ticDataTraining, aes(x = MSKB1)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MSKB1), 1)) +
    xlab("Social Class B1") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MSKB2) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialB2 <- ggplot(data = ticDataTraining, aes(x = MSKB2)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MSKB2), 1)) +
    xlab("Social Class B2") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MSKC) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialC <- ggplot(data = ticDataTraining, aes(x = MSKC)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MSKC), 1)) +
    xlab("Social Class C") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MSKD) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialD <- ggplot(data = ticDataTraining, aes(x = MSKD)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MSKD), 1)) +
    xlab("Social Class D") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MHHUUR) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotRentHouse <- ggplot(data = ticDataTraining, aes(x = MHHUUR)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MHHUUR), 1)) +
    xlab("Rented House") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MHKOOP) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotOwnHome <- ggplot(data = ticDataTraining, aes(x = MHKOOP)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MHKOOP), 1)) +
    xlab("Home Owners") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MAUT1) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotOneCar <- ggplot(data = ticDataTraining, aes(x = MAUT1)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MAUT1), 1)) +
    xlab("Owns One Car") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MAUT2) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotTwoCars <- ggplot(data = ticDataTraining, aes(x = MAUT2)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MAUT2), 1)) +
    xlab("Owns Two Cars") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MAUT0) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNoCar <- ggplot(data = ticDataTraining, aes(x = MAUT0)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MAUT0), 1)) +
    xlab("No Car Owned") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MZFONDS) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNHS <- ggplot(data = ticDataTraining, aes(x = MZFONDS)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MZFONDS), 1)) +
    xlab("National Health Service") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MZPART) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotPHS <- ggplot(data = ticDataTraining, aes(x = MZPART)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MZPART), 1)) +
    xlab("Private Health Insurance") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MINKM30) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotIncome30k <- ggplot(data = ticDataTraining, aes(x = MINKM30)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MINKM30), 1)) +
    xlab("Income < 30k") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MINK3045) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotIncome30_45k <- ggplot(data = ticDataTraining, aes(x = MINK3045)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MINK3045), 1)) +
    xlab("30k < Income < 45k") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MINK4575) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotIncome45_75k <- ggplot(data = ticDataTraining, aes(x = MINK4575)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MINK4575), 1)) +
    xlab("45k < Income < 75k") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MINK7512) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotIncome75k_122k <- ggplot(data = ticDataTraining, aes(x = MINK7512)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MINK7512), 1)) +
    xlab("75k < Income < 122k") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MINK123M) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotIncome123k <- ggplot(data = ticDataTraining, aes(x = MINK123M)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MINK123M), 1)) +
    xlab("Income > 122k") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MINKGEM) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotAvgIncome <- ggplot(data = ticDataTraining, aes(x = MINKGEM)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MINKGEM), 1)) +
    xlab("Average Income Populations") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(MKOOPKLA) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotPurchasingPower <- ggplot(data = ticDataTraining, aes(x = MKOOPKLA)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$MKOOPKLA), 1)) +
    xlab("Purchasing Power") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AWAPART) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNumThirdPartyIns <- ggplot(data = ticDataTraining, aes(x = AWAPART)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AWAPART), 1)) +
    xlab("No. of 3rd Party Insurances") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PWAPART) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNumThirdPartyInsCont <- ggplot(data = ticDataTraining, aes(x = PWAPART)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PWAPART), 1)) +
    xlab("3rd Party Insurance Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AWABEDR) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNumThirdPartyInsFirm <- ggplot(data = ticDataTraining, aes(x = AWABEDR)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AWABEDR), 1)) +
    xlab("No. of 3rd Party Insurances for FIRMS") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PWABEDR) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNumThirdPartyInsFirmCont <- ggplot(data = ticDataTraining, aes(x = PWABEDR)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PWABEDR), 2)) +
    xlab("3rd Party Insurance Contributions for Firms") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AWALAND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNumThirdPartyInsAgri <- ggplot(data = ticDataTraining, aes(x = AWALAND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AWALAND), 1)) +
    xlab("No. of 3rd Party Insurances for Agriculture") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PWALAND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotNumThirdPartyInsAgriCont <- ggplot(data = ticDataTraining, aes(x = PWALAND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PWALAND), 1)) +
    xlab("3rd Party Insurance Contributions - Agriculture") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(APERSAUT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotCarPolicy <- ggplot(data = ticDataTraining, aes(x = APERSAUT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$APERSAUT), 1)) +
    xlab("No. of Car Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PPERSAUT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotCarPolicyCont <- ggplot(data = ticDataTraining, aes(x = PPERSAUT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PPERSAUT), 4)) +
    xlab("Car Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(ABESAUT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotVanPolicy <- ggplot(data = ticDataTraining, aes(x = ABESAUT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$ABESAUT), 1)) +
    xlab("No. of Delivery Van Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PBESAUT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotVanPolicyCont <- ggplot(data = ticDataTraining, aes(x = PBESAUT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PBESAUT), 2)) +
    xlab("Van Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AMOTSCO) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotScooterPolicy <- ggplot(data = ticDataTraining, aes(x = AMOTSCO)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AMOTSCO), 1)) +
    xlab("No. of Scooter Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PMOTSCO) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotScooterPolicyCont <- ggplot(data = ticDataTraining, aes(x = PMOTSCO)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PMOTSCO), 4)) +
    xlab("Scooter Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AVRAAUT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotLorryPolicy <- ggplot(data = ticDataTraining, aes(x = AVRAAUT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AVRAAUT), 1)) +
    xlab("No. of Scooter Policies * Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PVRAAUT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotLorryPolicyCont <- ggplot(data = ticDataTraining, aes(x = PVRAAUT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PVRAAUT), 2)) +
    xlab("Lorry Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AAANHANG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotTrailerPolicy <- ggplot(data = ticDataTraining, aes(x = AAANHANG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AAANHANG), 1)) +
    xlab("No. of Trailer Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PAANHANG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotTrailerPolicyCont <- ggplot(data = ticDataTraining, aes(x = PAANHANG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PAANHANG), 1)) +
    xlab("Trailer Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(ATRACTOR) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotTractorPolicy <- ggplot(data = ticDataTraining, aes(x = ATRACTOR)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$ATRACTOR), 1)) +
    xlab("No. of Tractor Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PTRACTOR) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotTractorPolicyCont <- ggplot(data = ticDataTraining, aes(x = PTRACTOR)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PTRACTOR), 2)) +
    xlab("Tractor Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AWERKT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotAgriMachinePolicy <- ggplot(data = ticDataTraining, aes(x = AWERKT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AWERKT), 1)) +
    xlab("No. of Agricultural Machine Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PWERKT) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotAgriMachinePolicyCont <- ggplot(data = ticDataTraining, aes(x = PWERKT)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PWERKT), 2)) +
    xlab("Agricultural Machine Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(ABROM) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotMopedPolicy <- ggplot(data = ticDataTraining, aes(x = ABROM)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$ABROM), 1)) +
    xlab("No. of Moped Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PBROM) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotMopedPolicyCont <- ggplot(data = ticDataTraining, aes(x = PBROM)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PBROM), 1)) +
    xlab("Moped Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(ALEVEN) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotLifePolicy <- ggplot(data = ticDataTraining, aes(x = ALEVEN)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$ALEVEN), 1)) +
    xlab("No. of Life Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PLEVEN) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotLifePolicyCont <- ggplot(data = ticDataTraining, aes(x = PLEVEN)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 4) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PLEVEN), 4)) +
    xlab("Life Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(APERSONG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotPvtAccidentPolicy <- ggplot(data = ticDataTraining, aes(x = APERSONG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$APERSONG), 1)) +
    xlab("No. of Private Accident Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PPERSONG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotPvtAccidentPolicyCont <- ggplot(data = ticDataTraining, aes(x = PPERSONG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PPERSONG), 1)) +
    xlab("Private Accident Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AGEZONG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotFamAccidentPolicy <- ggplot(data = ticDataTraining, aes(x = AGEZONG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AGEZONG), 1)) +
    xlab("No. of Family Accident Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PGEZONG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotFamAccidentPolicyCont <- ggplot(data = ticDataTraining, aes(x = PGEZONG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PGEZONG), 1)) +
    xlab("Family Accident Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AWAOREG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotDisabilityPolicy <- ggplot(data = ticDataTraining, aes(x = AWAOREG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AWAOREG), 1)) +
    xlab("No. of Disability Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PWAOREG) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotDisabilityPolicyCont <- ggplot(data = ticDataTraining, aes(x = PWAOREG)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PWAOREG), 1)) +
    xlab("Disability Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(ABRAND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotFirePolicy <- ggplot(data = ticDataTraining, aes(x = ABRAND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$ABRAND), 1)) +
    xlab("No. of Fire Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PBRAND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotFirePolicyCont <- ggplot(data = ticDataTraining, aes(x = PBRAND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PBRAND), 1)) +
    xlab("Fire Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AZEILPL) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSurfPolicy <- ggplot(data = ticDataTraining, aes(x = AZEILPL)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AZEILPL), 1)) +
    xlab("No. of SurfBoard Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PZEILPL) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSurfPolicyCont <- ggplot(data = ticDataTraining, aes(x = PZEILPL)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PZEILPL), 1)) +
    xlab("SurfBoard Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(APLEZIER) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotBoatPolicy <- ggplot(data = ticDataTraining, aes(x = APLEZIER)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$APLEZIER), 1)) +
    xlab("No. of Boat Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PPLEZIER) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotBoatPolicyCont <- ggplot(data = ticDataTraining, aes(x = PPLEZIER)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PPLEZIER), 1)) +
    xlab("Boat Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AFIETS) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotBicyclePolicy <- ggplot(data = ticDataTraining, aes(x = AFIETS)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AFIETS), 1)) +
    xlab("No. of Bicycle Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PFIETS) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotBicyclePolicyCont <- ggplot(data = ticDataTraining, aes(x = PFIETS)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PFIETS), 1)) +
    xlab("Bicycle Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(AINBOED) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotPropertyPolicy <- ggplot(data = ticDataTraining, aes(x = AINBOED)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$AINBOED), 1)) +
    xlab("No. of Property Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PINBOED) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotPropertyPolicyCont <- ggplot(data = ticDataTraining, aes(x = PINBOED)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PINBOED), 1)) +
    xlab("Property Policies Contributions") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(ABYSTAND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialPolicy <- ggplot(data = ticDataTraining, aes(x = ABYSTAND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$ABYSTAND), 1)) +
    xlab("No. of Social Security Policies") +
    ylab("Proportion") +
    theme_bw()

ticDataTraining <- ticDataTraining %>%
    group_by(PBYSTAND) %>%
    mutate(percent_caravan = sum(CARAVAN) / totalCaravanPolicies) %>%
    ungroup()

plotSocialPolicyCont <- ggplot(data = ticDataTraining, aes(x = PBYSTAND)) +
    geom_bar(aes(y = ..count../sum(..count..))) +
    geom_point(aes(y = percent_caravan)) +
    geom_line(aes(y = percent_caravan), linetype = 2) +
    scale_x_continuous(breaks = seq(0, max(ticDataTraining$PBYSTAND), 1)) +
    xlab("Social Security Policies Contributions") +
    ylab("Proportion") +
    theme_bw()
```

#### Plotting Using Grid Arrange

```{r eval = FALSE, fig.width = 12, fig.height = 60}
grid.arrange(plotHomesOwned, plotHouseHoldSize, PlotAvgAge, plotRomanCatholics, plotProtestants, plotOtherReligion,
             plotNoReligion, plotMarried, plotLivingTogether, plotOtherRelation, plotSingles, plotHouseholdNoChild,
             plotHouseholdWithChild, plotHouseholdHighEd, plotHouseholdMidEd, plotHouseholdLowEd, plotHighStatus,
             plotEntrepreneur, plotFarmer, plotMidManagement, plotSkilledLabor, plotUnskilledLabor, plotSocialA,
             plotSocialB1, plotSocialB2, plotSocialC, plotSocialD, plotRentHouse, plotOwnHome, plotOneCar, 
             plotTwoCars, plotNoCar, plotNHS, plotPHS, plotIncome30k, plotIncome30_45k, plotIncome45_75k, 
             plotIncome75k_122k, plotIncome123k, plotAvgIncome, plotPurchasingPower, plotNumThirdPartyIns,
             plotNumThirdPartyInsCont, plotNumThirdPartyInsFirm, plotNumThirdPartyInsFirmCont, plotNumThirdPartyInsAgri,
             plotNumThirdPartyInsAgriCont, plotCarPolicy, plotCarPolicyCont, plotVanPolicy, plotVanPolicyCont,
             plotScooterPolicy, plotScooterPolicyCont, plotLorryPolicy, plotLorryPolicyCont, plotTrailerPolicy,
             plotTrailerPolicyCont, plotTractorPolicy, plotTractorPolicyCont, plotAgriMachinePolicy,
             plotAgriMachinePolicyCont, plotMopedPolicy, plotMopedPolicyCont, plotLifePolicy, plotLifePolicyCont,
             plotPvtAccidentPolicy, plotPvtAccidentPolicyCont, plotFamAccidentPolicy, plotFamAccidentPolicyCont,
             plotDisabilityPolicy, plotDisabilityPolicyCont, plotFirePolicy, plotFirePolicyCont, plotSurfPolicy,
             plotSurfPolicyCont, plotBoatPolicy, plotBoatPolicyCont, plotBicyclePolicy, plotBicyclePolicyCont,
             plotPropertyPolicy, plotPropertyPolicyCont, plotSocialPolicy, plotSocialPolicyCont, ncol = 2)
```

#### Observations:

From the plots the following conditions imply a higher proportion of caravan policy owners than expected:

1. Zipcodes with a less number of low level educated people
2. Zipcodes with very high status people
3. Zipcodes with NO FARMERS
4. Zipcodes with low number of laborers (skilled & unskilled)
5. Zipcodes with low number of people belonging to social classes C & D
6. Zipcodes having a very high number of Home Owners
7. Zipcodes with low or no rented homes
8. Zipcodes having a high car ownership
9. Zipcodes having little to no population with income < 30k
10. Zipcodes with average income households
11. Zipcodes with high purchasing power >= 6
12. Individuals that have a private third party insurance
13. Individuals with high contributions to third party insurance
14. Individuals with one or more car policy
15. Individuals with high contributions to their car policies
16. Individuals with Fire Insurance Policy
17. Individuals making high contributions to fire insurance policies

The above factors are worth further investigation to draw more concrete trends

```{r}
ggplot(ticDataTraining, aes(x = APERSAUT, y = PPERSAUT, color = as.factor(CARAVAN))) +
    geom_jitter() + 
    xlab("Num. Car Policies") +
    ylab("Contributions") +
    theme_bw() +
    scale_x_continuous(breaks =seq(0, max(ticDataTraining$APERSAUT), 1))
```

The plot indicates that people who have a car policy tend to contribute significantly towards it.

```{r}
ggplot(ticDataTraining, aes(x = AWAPART, y = PWAPART, color = as.factor(CARAVAN))) +
    geom_jitter() + 
    xlab("Private Third Party Insurance") +
    ylab("Contributions") +
    theme_bw() +
    scale_x_continuous(breaks =seq(0, max(ticDataTraining$AWAPART), 1))
```

```{r}
ggplot(ticDataTraining, aes(x = ABRAND, y = PBRAND, color = as.factor(CARAVAN))) +
    geom_jitter() + 
    xlab("Num. Fire Policies") +
    ylab("Contributions") +
    theme_bw() +
    scale_x_continuous(breaks =seq(0, max(ticDataTraining$ABRAND), 1))
```

### Automatic Variable Selection, Forward and Backward

```{r}
ticDataTraining <- ticDataTraining[,1:86]
ticDataTraining$MOSTYPE <- as.factor(ticDataTraining$MOSTYPE)
ticDataTest$MOSTYPE <- as.factor(ticDataTest$MOSTYPE)
ticDataTraining$MOSHOOFD <- as.factor(ticDataTraining$MOSHOOFD)
ticDataTest$MOSHOOFD <- as.factor(ticDataTest$MOSHOOFD)
ticDataTraining$CARAVAN <- as.factor(ticDataTraining$CARAVAN)
ticDataTest$CARAVAN <- as.factor(ticDataTest$CARAVAN)

reg_Backward <- regsubsets(CARAVAN ~., data = ticDataTraining, method = "backward")
reg_Forward <- regsubsets(CARAVAN ~., data = ticDataTraining, method = "forward")
```

### SVM Classifier Using Linear and Radial Kernels

```{r}
ticData.SVM.Linear <- svm(CARAVAN ~ ., data = ticDataTraining, kernel = "linear", probability = TRUE)
ticData.SVM.Radial <- svm(CARAVAN ~ ., data = ticDataTraining, kernel = "radial", probability = TRUE)
ticData.SVM.Linear.Pred <- predict(ticData.SVM.Linear, newdata = ticDataTest[-86], probability = TRUE)
ticData.SVM.Radial.Pred <- predict(ticData.SVM.Radial, newdata = ticDataTest[-86], probability = TRUE)
```

### Naive Bayes Classifier

```{r}
ticData.NB <- naiveBayes(data = ticDataTraining, CARAVAN ~ ., laplace = 3)
ticData.NB.pred <- predict(ticData.NB, ticDataTest[-86], type = "raw")
```

### Decision Tree Classifier

```{r, fig.width = 6, fig.height = 8}
ticData.Tree <- rpart(CARAVAN ~ ., data = ticDataTraining, method = "class", 
                      control = rpart.control(minsplit=2, minbucket=1, cp=0.001))
ticData.PrunedTree <- prune(ticData.Tree, 0.0045, control = rpart.control(minsplit=2, minbucket=1))
plot(ticData.PrunedTree, uniform = TRUE, margin = 0.1)
text(ticData.PrunedTree, use.n = T, cex = 0.8)
ticDataTraining.PredictTree <- predict(ticData.PrunedTree)
ticDataTest.PredictTree <- predict(ticData.PrunedTree, ticDataTest[-86])
```

### Random Forest Classifier

```{r, fig.width = 12, fig.height = 10}
ticData.RF <- randomForest(CARAVAN ~ ., 
                                   data = ticDataTraining, 
                                   nTree = 100,
                                   importance = TRUE,
                                   proximity = TRUE)

round(importance(ticData.RF),2)
ticData.RF.pred <- predict(ticData.RF, newdata = ticDataTest[-86], type = "prob")
```

### Building a Logistic Regression Model Using Variables from forward/backward variable selection

```{r}
ticDataLogitModel.FB.Var <- glm(data = ticDataTraining, CARAVAN ~ 
                             MRELGE +
                             MOPLLAAG +
                             MBERBOER +
                             MKOOPKLA +
                             PWALAND +
                             PWAPART +
                             PPERSAUT +
                             PBRAND +
                             APLEZIER +
                             ABYSTAND,
                         family = binomial)

summary(ticDataLogitModel.FB.Var)
anova(ticDataLogitModel.FB.Var, test = "Chisq")
ticData.Logit.FB.Pred <- predict(ticDataLogitModel.FB.Var, newdata = ticDataTest[-86], type = "response")
```

### Logit Model 2 Using Variable importance table from Random Forest Classifier

```{r}
ticDataLogitModel.RF.Var <- glm(data = ticDataTraining, CARAVAN ~ 
#                             MOSTYPE +
                             MKOOPKLA +
                             PBRAND +
                             APERSAUT +
                             PWAPART +
                             PPERSAUT,
                         family = binomial)

summary(ticDataLogitModel.RF.Var)
anova(ticDataLogitModel.RF.Var, test = "Chisq")
ticData.Logit.RF.Pred <- predict(ticDataLogitModel.RF.Var, newdata = ticDataTest[-86], type = "response")
```

### Comparing the Classifier Models:

```{r, fig.width = 8, fig.height = 6}
c.legend <- c("Decision Tree AUC = ", 
              "Random Forest AUC = ", 
              "Naive Bayes AUC = ",
              "SVM Linear AUC = ",
              "SVM Radial AUC = ",
              "Logit with Fwd/Back Variable Selection AUC = ",
              "Logit with Random Forest Variable Selection AUC = ")

# ROC For Decision Tree

pred <- prediction(ticDataTest.PredictTree[,2], ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, col = "red", lwd = 2)
c.legend[1] <- paste(c.legend[1], round((performance(pred, 'auc')@y.values)[[1]],3))

# ROC For Random Forest

pred <- prediction(ticData.RF.pred[,2], ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, add = TRUE, col = "green", lwd = 2)
c.legend[2] <- paste(c.legend[2], round((performance(pred, 'auc')@y.values)[[1]],3))

#ROC For Naive Bayes

pred <- prediction(ticData.NB.pred[,2], ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, add = TRUE, col = "blue", lwd = 2)
c.legend[3] <- paste(c.legend[3], round((performance(pred, 'auc')@y.values)[[1]],3))

#ROC For SVM Linear Kernel

pred <- prediction(attr(ticData.SVM.Linear.Pred, "probabilities")[,2], ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, add = TRUE, col = "purple", lwd = 2)
c.legend[4] <- paste(c.legend[4], round((performance(pred, 'auc')@y.values)[[1]],3))

#ROC For SVM Radial Kernel

pred <- prediction(attr(ticData.SVM.Radial.Pred, "probabilities")[,2], ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, add = TRUE, col = "black", lwd = 2)
c.legend[5] <- paste(c.legend[5], round((performance(pred, 'auc')@y.values)[[1]],3))

#ROC For Logit with Forward/Backward variable selection

pred <- prediction(ticData.Logit.FB.Pred, ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, add = TRUE, col = "cyan", lwd = 2)
c.legend[6] <- paste(c.legend[6], round((performance(pred, 'auc')@y.values)[[1]],3))

#ROC For Logit with Random Forest variable selection

pred <- prediction(ticData.Logit.RF.Pred, ticDataTest$CARAVAN)
perf <- performance(pred, "tpr", "fpr")
plot(perf, add = TRUE, col = "pink", lwd = 2)
c.legend[7] <- paste(c.legend[7], round((performance(pred, 'auc')@y.values)[[1]],3))

legend("bottomright", 
       c.legend, 
       lty = c(1,1,1,1,1,1,1), 
       lwd = c(2,2,2,2,2,2,2), 
       col = c("red", "green", "blue", "purple", "black", "cyan", "pink"),
       pch=21, cex = 1)
```